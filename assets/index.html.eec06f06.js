import{_ as o,r as p,o as i,c,a as e,b as n,d as a,e as t}from"./app.3e33cde9.js";const r="/simple-3d-printer/assets/image-20220309193844931.1144eef8.png",l="/simple-3d-printer/assets/big-fish-i3.a830baac.jpeg",d="data:image/png;base64,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",u="/simple-3d-printer/assets/image-20220330051541011.76bc1d2f.png",h="/simple-3d-printer/assets/image-20220312054743069.b7753809.png",m="/simple-3d-printer/assets/image-20220312064107893.a38e7068.png",k="/simple-3d-printer/assets/052B3E34-1BB4-4F72-92F0-9E9F1A33BFCE_1646712370349.845f87c6.jpeg",v="/simple-3d-printer/assets/16467305795311.f9f1af10.png",b="/simple-3d-printer/assets/9D04FC9D-22CA-49D8-B0CE-71BEA0E9D407_1646716173573-16467162065611.4f3174fe.jpeg",g="/simple-3d-printer/assets/image-20220312064937037.2bffaea6.png",w={},f=e("p",null,[e("img",{src:r,alt:"image-20220309193844931"})],-1),y=e("h1",{id:"how-3d-printer-works",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#how-3d-printer-works","aria-hidden":"true"},"#"),n(" How 3d printer works?")],-1),A={href:"https://github.com/arnosolo/simple_3d_printer",target:"_blank",rel:"noopener noreferrer"},_=e("h3",{id:"setup",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#setup","aria-hidden":"true"},"#"),n(" Setup")],-1),x=e("h4",{id:"hardware",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#hardware","aria-hidden":"true"},"#"),n(" Hardware")],-1),S=e("p",null,"\u200B Firstly, we need a 3D printer that is already able to print. So if we encounter any issue while we are writing firmware, we know it's not a hardware problem. You can buy a machine directly, but I would recommend you assemble one by yourself. In this way, If there is a mechanical problem, you can handle it by yourself since you already familiar with the mechanical structure and also because you have schematic to check which these commercial companies probably not willing to provide. Here are hardware I choosen.",-1),B=e("p",null,"Mother board",-1),C={href:"https://github.com/makerbase-mks/MKS-GEN_L/tree/master/hardware/MKS%20Gen_L%20V2.1_001",target:"_blank",rel:"noopener noreferrer"},E={href:"https://ww1.microchip.com/downloads/en/devicedoc/atmel-2549-8-bit-avr-microcontroller-atmega640-1280-1281-2560-2561_datasheet.pdf",target:"_blank",rel:"noopener noreferrer"},M=t('<li><p>Stepper driver</p><ul><li>X TMC2008</li><li>Y TMC2008</li><li>Z A4988</li><li>E TMC2225</li></ul></li><li><p>Mechanical structure</p><ul><li><p>Big fish i3</p><img title="" src="'+l+'" alt="big-fish-i3" width="254"></li></ul></li>',2),F=e("h4",{id:"software",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#software","aria-hidden":"true"},"#"),n(" Software")],-1),Y=e("p",null,"In this step, we want make sure the MCU can run our code.",-1),D={href:"https://code.visualstudio.com/",target:"_blank",rel:"noopener noreferrer"},T=t(`<li><p>Install addon <code>platformio</code></p></li><li><p>Open platformio tag, create new project, choose Board as mega2560, choose Framework as Arduino.</p></li><li><p>Now we write some test code in <code>src/main.cpp</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// src/main.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Arduino.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello from Mega2560.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Connect 3D printing motherboard with compute, click the right arrow \u27A1 button at the bottom of <code>vscode</code>. Then <code>platformio</code> will compile and upload the test code above into 3D printing motherboard</p><p><img src="`+d+'" alt="image-20220325104440980"></p></li><li><p>Open any Serial assistant you prefer, connect the motherboard, if you found <code>Hello from Mega2560.</code> is printed, then you are all set.</p></li>',5),N=e("h3",{id:"parse-gcode",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#parse-gcode","aria-hidden":"true"},"#"),n(" Parse gcode")],-1),H={href:"https://ultimaker.com/software/ultimaker-cura",target:"_blank",rel:"noopener noreferrer"},I={href:"https://www.prusa3d.com/page/prusaslicer_424/",target:"_blank",rel:"noopener noreferrer"},X=e("p",null,[e("img",{src:u,alt:"image-20220330051541011"})],-1),L=t(`<p>Most used gcode</p><div class="language-gcode ext-gcode line-numbers-mode"><pre class="language-gcode"><code><span class="token keyword">G1</span> <span class="token property">F</span>200 <span class="token property">X</span>2 <span class="token property">Y</span>4 <span class="token comment">; move to (2,4,0) and set feedrate as 200mm/min, 99% gcodes looks like this</span>
<span class="token keyword">G28</span> <span class="token property">X</span>0 <span class="token property">Y</span>0 <span class="token comment">; move X/Y to min endstops</span>
<span class="token keyword">M104</span> <span class="token property">S</span>200 <span class="token comment">; set hotend temp as 200\u2103</span>
<span class="token keyword">M20</span> <span class="token comment">; List SD Card</span>
<span class="token keyword">M23</span> <span class="token comment">; Select SD file</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),j={href:"https://marlinfw.org/docs/gcode/G000-G001.html",target:"_blank",rel:"noopener noreferrer"},G=t(`<p>In this section, we should implement the <code>parse</code> function of <code>Gcode</code> class which is able to convert a gcode string like <code>G1 X2.4 Y5.6</code> into a <code>gcode object</code>.</p><ul><li><p><code>gcode object</code> example</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>gcode<span class="token punctuation">.</span>cmdtype <span class="token operator">=</span> <span class="token char">&#39;G&#39;</span><span class="token punctuation">;</span>
gcode<span class="token punctuation">.</span>cmdnum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
gcode<span class="token punctuation">.</span>X <span class="token operator">=</span> <span class="token number">2.4</span><span class="token punctuation">;</span>
gcode<span class="token punctuation">.</span>Y <span class="token operator">=</span> <span class="token number">5.6</span><span class="token punctuation">;</span>
gcode<span class="token punctuation">.</span>hasX <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
gcode<span class="token punctuation">.</span>hasY <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Notice that if you try to use &#39;\\n&#39; to split string like me, you need be careful that some gcode string might end with &quot;\\r\\n&quot;</p></li></ul><h3 id="sd-card" tabindex="-1"><a class="header-anchor" href="#sd-card" aria-hidden="true">#</a> SD card</h3>`,3),P={href:"https://github.com/arduino-libraries/SD",target:"_blank",rel:"noopener noreferrer"},K=e("code",null,"CS",-1),O=e("code",null,"SD.begin(csPin)",-1),W=e("code",null,"setup",-1),R=t('<h3 id="temperature-control" tabindex="-1"><a class="header-anchor" href="#temperature-control" aria-hidden="true">#</a> Temperature control</h3><p>Call <code>hotend.update()</code> every 150ms, which will decide turn the heater on or off according to current temperature.</p><ul><li>150ms interval was implemented using timer(<code>Heater::init</code>)</li><li>Temperature control algorithm is PID(<code>Heater::calculatePid</code>)</li></ul><h3 id="motor-control" tabindex="-1"><a class="header-anchor" href="#motor-control" aria-hidden="true">#</a> Motor control</h3><p>In this section, we should figure out how to control stepper motor through a stepper motor driver like <code>A4988</code>.</p><h4 id="a4988" tabindex="-1"><a class="header-anchor" href="#a4988" aria-hidden="true">#</a> A4988</h4><p><img src="'+h+`" alt="image-20220312054743069"></p><ol><li><p>VMOT</p><p>8V~35V DC, A 100uf capacitor needs to be placed between <code>VMOT</code> and <code>GND</code> to quickly respond to the motor&#39;s power demand. Beware, this is the only pin that connect high voltage, if you connect other pins with 24V DC, this module will <strong>burn in seconds</strong>.</p></li><li><p>1A 1B</p><p>Connect to coil 1 of the stepper motor</p></li><li><p>2A 2B</p><p>Connect to coil 2 of the stepper motor</p></li><li><p>VDD</p><p>MCU power</p></li><li><p>DIR</p><p>Connect to MCU, high and low each represent a different direction.</p></li><li><p>STEP</p><p>Each time this pin receives a pulse, <code>A4988</code> will dive the stepper motor advance one step. Normal stepper motor used in 3d printer takes 200 steps to complete a revolution, which means 200 pulses.</p></li><li><p>MS1 MS2 MS3</p><p>But in most conditions, to drive stepper motor advance one revolution, 3200 pulses should be feed into A4988. That&#39;s because one step is divided into 16 micro steps.</p><table><thead><tr><th>MS1</th><th>MS2</th><th>MS3</th><th>subdivision</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>1</td></tr><tr><td>1</td><td>0</td><td>0</td><td>2</td></tr><tr><td>0</td><td>1</td><td>0</td><td>4</td></tr><tr><td>1</td><td>1</td><td>0</td><td>8</td></tr><tr><td>1</td><td>1</td><td>1</td><td>16</td></tr></tbody></table></li><li><p>ENABLE</p><p>LOW: enable module</p><p>HIGH: disable module</p></li><li><p>SLEEP</p><p>LOW: sleep</p><p>HIGH: active</p></li><li><p>RESET</p><p>LOW: reset module</p></li></ol><h4 id="steps-per-unit" tabindex="-1"><a class="header-anchor" href="#steps-per-unit" aria-hidden="true">#</a> Steps per unit</h4><p>Now we know how to control stepper motor through <code>A4988</code>. But how long does the hotend travel(mm) if motor advance one step?</p><ul><li><p>Synchronized pulleys and belts</p><p>Take the 2GT 20-tooth synchronous wheel as an example. 2GT means that one tooth corresponds 2mm, then if the synchronous wheel has 20 teeth, each time it rotates 1 revolution, the belt will travels 40mm. And if we motor drive as 16 subdivision, then one revolution means 3200 pulses is needed.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>stepPerUnit = 3200steps / 40mm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Screw</p><p>Take a screw with a pitch of 2mm and a lead of 8mm as an example. The lead means the linear distance traveled by the screw for one revolution.</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>stepPerUnit = 3200steps / 8mm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><h3 id="endstop" tabindex="-1"><a class="header-anchor" href="#endstop" aria-hidden="true">#</a> Endstop</h3><p><img src="`+m+'" alt="image-20220312064107893"></p><p><code>Endstop</code> has 3 pins: normal open(<code>NO</code>), normal close(<code>NC</code>), circuit common(<code>COM</code>). If we the <code>NC</code> and <code>COM</code> then:</p><table><thead><tr><th>State</th><th>on or off</th><th>MCU read</th></tr></thead><tbody><tr><td>not triggered</td><td>on</td><td>LOW</td></tr><tr><td>triggered</td><td>break</td><td>HIGH</td></tr></tbody></table><h3 id="motion-control" tabindex="-1"><a class="header-anchor" href="#motion-control" aria-hidden="true">#</a> Motion control</h3><h4 id="how-to-advance" tabindex="-1"><a class="header-anchor" href="#how-to-advance" aria-hidden="true">#</a> How to advance</h4><p>Assuming that our starting point is (0,0), target point is (6, 3). Then <code>motorX</code> shoud advance (6 x 80) steps, <code>motorY</code> should advance (3 x 80) steps. Of course, we can demand the <code>motorX</code> to advance first then <code>motorY</code> like Plan B. But there is a better way like Plan A.</p><img src="'+k+`" alt="052B3E34-1BB4-4F72-92F0-9E9F1A33BFCE_1646712370349" style="zoom:57%;"><p>This is <em>Bresenham&#39;s algorithm.</em> Specifically, since it takes 480 steps in the X direction and 240 steps in the Y direction, hotend should move 480 times, each time <code>motorX</code> advance one step, however <code>motorY</code> advance one step each tow times. Each time of motion is called a <code>step event</code>. The total number of times is called <code>step event count</code>, and its value is the greater of X and Y.</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// module/Planner.cpp - planBufferLine</span>
block<span class="token punctuation">.</span>stepEventCount <span class="token operator">=</span> <span class="token function">getMax</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span>steps<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// main.cpp - motion control isr</span>
motorX<span class="token punctuation">.</span>deltaError <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>curBlock<span class="token operator">-&gt;</span>stepEventCount <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
motorY<span class="token punctuation">.</span>deltaError <span class="token operator">=</span> motorX<span class="token punctuation">.</span>deltaError<span class="token punctuation">;</span>

motorX<span class="token punctuation">.</span>deltaError <span class="token operator">+=</span> curBlock<span class="token operator">-&gt;</span>steps<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>motorX<span class="token punctuation">.</span>deltaError <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    motorX<span class="token punctuation">.</span><span class="token function">moveOneStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    motorX<span class="token punctuation">.</span>deltaError <span class="token operator">-=</span> curBlock<span class="token operator">-&gt;</span>stepEventCount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

motorY<span class="token punctuation">.</span>deltaError <span class="token operator">+=</span> curBlock<span class="token operator">-&gt;</span>steps<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>motorY<span class="token punctuation">.</span>deltaError <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    motorY<span class="token punctuation">.</span><span class="token function">moveOneStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    motorY<span class="token punctuation">.</span>posInSteps <span class="token operator">+=</span> curBlock<span class="token operator">-&gt;</span>dir<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    motorY<span class="token punctuation">.</span>deltaError <span class="token operator">-=</span> curBlock<span class="token operator">-&gt;</span>stepEventCount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Do not use <strong>float</strong> to calculate the number of steps directly, because it might lead to step missing.</p><p><img src="`+v+`" alt="\u96F6\u4EF6\u5931\u6B65\u7684\u539F\u56E0\u6700\u7EC8\u627E\u5230\u4E86, \u5C45\u7136\u662F\u6D6E\u70B9\u6570\u7684\u8BA1\u7B97\u8BEF\u5DEE"></p><h4 id="multiple-motion-commands" tabindex="-1"><a class="header-anchor" href="#multiple-motion-commands" aria-hidden="true">#</a> Multiple motion commands</h4><p>We should push a <code>block</code> which contains how many steps every motor should advance in a <code>queue</code>, and take it out when needed.</p><ul><li><p><code>block</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>block<span class="token punctuation">.</span>dir<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span>
block<span class="token punctuation">.</span>steps<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">37</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
block<span class="token punctuation">.</span>stepEventCount <span class="token operator">=</span> <span class="token number">37</span>
block<span class="token punctuation">.</span>accelerateUntil <span class="token operator">=</span> <span class="token number">6</span>
block<span class="token punctuation">.</span>decelerateAfter <span class="token operator">=</span> <span class="token number">37</span>
block<span class="token punctuation">.</span>entryRate <span class="token operator">=</span> <span class="token number">1808</span>
block<span class="token punctuation">.</span>nominalRate <span class="token operator">=</span> <span class="token number">2001</span>
block<span class="token punctuation">.</span>exitRate <span class="token operator">=</span> <span class="token number">2001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="speed-control" tabindex="-1"><a class="header-anchor" href="#speed-control" aria-hidden="true">#</a> Speed control</h3><p>For example, if we want set speed as 1000steps/s, then every <code>step event</code> takes 1ms, which means every 1ms an interrupt should be generated.</p><h4 id="trapezoidal-acceleration" tabindex="-1"><a class="header-anchor" href="#trapezoidal-acceleration" aria-hidden="true">#</a> Trapezoidal acceleration</h4><p>We can set speed as constant, but changing the speed can improve efficiency.</p><p>Specifically, a block can be divided into an acceleration segment, a constant speed segment and a deceleration segment. Noted that if the length of block is very short, the acceleration graph should becomes a triangle.</p><p><img src="`+b+'" alt="9D04FC9D-22CA-49D8-B0CE-71BEA0E9D407_1646716173573"></p><h4 id="connection-speed" tabindex="-1"><a class="header-anchor" href="#connection-speed" aria-hidden="true">#</a> Connection speed</h4><p>In order to prevent the speed and coherence between each block. We need to calculate the entry speed and exit speed of each block. The estimation method is given below. Noted that the arc in the figure is only used to estimate the connection speed. The hotend does not go through this arc in practice.</p><p><img src="'+g+'" alt="image-20220312064937037"></p>',35);function J(q,V){const s=p("ExternalLinkIcon");return i(),c("div",null,[f,y,e("p",null,[n("\u200B Hello, I am Arno. Today we are going to find out how 3d printer works by writing a firmware. "),e("a",A,[n("code link"),a(s)])]),_,x,S,e("ul",null,[e("li",null,[B,e("ul",null,[e("li",null,[e("p",null,[e("a",C,[n("MKS GENL V2.1"),a(s)])]),e("p",null,[n("which controlled by a "),e("a",E,[n("AVR mega2560"),a(s)])])])])]),M]),F,Y,e("ol",null,[e("li",null,[e("p",null,[n("Download "),e("a",D,[n("vscode"),a(s)])])]),T]),N,e("p",null,[n("Gcode was generated by Slicer like "),e("a",H,[n("Cura"),a(s)]),n(" or "),e("a",I,[n("Prusa"),a(s)]),n(". It tells the printer where the hotend should go and what temperature should it maintain.")]),X,e("ul",null,[e("li",null,[L,e("p",null,[n("check all gcodes in "),e("a",j,[n("online documents of Marlin"),a(s)])])])]),G,e("p",null,[n("In general, we need to configure SPI to use SD card. But we are using mega2560, we can use the "),e("a",P,[n("SD Library for Arduino"),a(s)]),n(". The only thing we need to do is find which pin is the "),K,n(" (chip select) pin in schematic and call "),O,n(" function in "),W,n(" function.")]),R])}const U=o(w,[["render",J],["__file","index.html.vue"]]);export{U as default};
